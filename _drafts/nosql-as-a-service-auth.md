---
layout: post
title:  "NoSQL as a Service (auth)"
date:   2015-11-16
categories: Orchestrate database db DBaaS NoSQL node.js passport auth
---

<img style="float: left;" src="/images/orchestrate-spin-logo.gif">

When Orchestrate was acquired by CenturyLink, their new blog articles were mixed in with the [CenturyLink Developer Center Blog](https://www.ctl.io/developers/blog). Search for "orchestrate" there and find a ton of great stuff. The original Orchestrate blog was de-linked from their main page but still has several good getting-started [blog posts](https://orchestrate.io/blog).

How to write a ReST client: https://www.ctl.io/developers/blog/post/writing-an-orchestrate-rest-client

How do you test/log/support the rest service.

To prevent SQL write unders, use a If-Match Request header with the document ref. So, get the data, store the ETag (ref), and when writing, use the If-Match Request header.

## The Project

As an example project, I want 

- An admin application
- A service that exposes data to other processes

We'll assume that administration is a tiny portion of the work load and that other process that need the data are the majority of calls.

We'll start with the admin app and keep in mind that we want the service distinct so it can be scaled/tested independently.

The point of the project is to do something familiar and switch out our database implementation for orchestrate.

## Why loopback?

ReST APIs are a first class citizen with documentation generated by swagger.


## Orchestrate registration

If are not a registered Orchestrate user, registration is easy and they provide one database as a free playground.

1. Visit the [registration page](https://dashboard.orchestrate.io/users/register)
1. Confirm your email address in their registration email.
1. Sign in
1. In the orchestrate dashboard, create your application - orchi-config-demo


## Build the app

Starting with authentication based on https://orchestrate.io/blog/2014/06/26/build-user-authentication-with-node-js-express-passport-and-orchestrate

packages

- bcryptjs: Optimized bcrypt in plain JavaScript with zero dependencies
- morgan: HTTP request logger middleware

Basic dependencies look like

```
  "dependencies": {
    "bcryptjs": "^2.3.0",
    "body-parser": "^1.14.1",
    "cookie-parser": "^1.4.0",
    "loopback": "^2.25.0",
    "method-override": "^2.3.5",
    "morgan": "^1.6.1",
    "orchestrate": "^0.6.0",
    "passport": "^0.3.2",
    "passport-local": "^1.0.0",
    "q": "^1.4.1"
  }
```

Create the loopback app

```
npm install -g strongloop
slc loopback
```

